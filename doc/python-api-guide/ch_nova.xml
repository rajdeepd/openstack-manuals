<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://docbook.org/ns/docbook"
    xmlns:xi="http://www.w3.org/2001/XInclude"
    xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0"
    xml:id="ch_creating_images_automatically">
    <title>Nova</title>
    <?dbhtml stop-chunking?>
        <section xml:id="list_servers">
            <title>List Servers</title>
        <para>
                The following program Lists the Virtual Machines</para>
        <programlisting language="python">
from credentials import get_nova_credentials_v2
from novaclient.client import Client

credentials = get_nova_credentials_v2()
nova_client = Client(**credentials)

print nova_client.servers.list()

        </programlisting>
    </section>

        <section xml:id="create_server">
            <title>Create Server</title>
        <para>
                The following program creates the server</para>
        <programlisting language="python">
import time
from credentials import get_nova_credentials_v2
from novaclient.client import Client

try:
    credentials = get_nova_credentials_v2()
    nova_client = Client(**credentials)

    image = nova_client.images.find(name="cirros")
    flavor = nova_client.flavors.find(name="m1.tiny")
    #net_id = '81bf592a-9e3f-4f84-a839-ae87df188dc1'
    net_id = 'd05a7729-4bcf-4149-9d8f-6a4764520a04'
    nic_d = [{'net-id': net_id}]
    instance = nova_client.servers.create(name="vm2", image=image,
                                      flavor=flavor, key_name="keypair-1", nics=nic_d)
    print "Sleeping for 5s after create command"
    time.sleep(5)
    print "List of VMs"
    print nova_client.servers.list()
finally:
    print "Execution Completed"


        </programlisting>
    </section>




    </section>

        <section xml:id="delete-server">
            <title>Delete Server</title>
        <para>
                The following program deletes the server</para>
        <programlisting language="python">
from credentials import get_nova_credentials_v2
from novaclient.client import Client

credentials = get_nova_credentials_v2()
nova_client = Client(**credentials)

servers_list = nova_client.servers.list()
server_del = "vm1"
server_exists = False

for s in servers_list:
    if s.name == server_del:
        print "the server %s exists" % server_del
        server_exists = True
        break
if not server_exists:
    print "server %s doesnot exist" % server_del
else:
    nova_client.servers.delete(s)
    print "deleting server............"
    print "server %s deleted" % server_del


        </programlisting>
    </section>


        <section xml:id="details-flavor">
            <title>Details of specified Flavor</title>
        <para>
                The following prints the details of a specified flavor</para>
        <programlisting language="python">
from credentials import get_nova_credentials_v2
from novaclient.client import Client

credentials = get_nova_credentials_v2()
nova_client = Client(**credentials)

flavors_list = nova_client.flavors.list()
flavor = "m1.tiny"
flavor_exists = False

for flav in flavors_list:
    if flav.name == flavor:
        print "flavor %s exists" % flavor
        flavor_exists = True
        break
if not flavor_exists:
    print "flavor %s doesnot exists" % flavor
else:
    print "flavor name:", flav.name
    print "flavor RAM:", flav.ram
    print "flavor vcpus:", flav.vcpus
    print "flavor disk:", flav.disk
    print "flavor id:", flav.id
    print "flavor ephemeral:", flav.ephemeral
    print "flavor factor:", flav.rxtx_factor
                                            

        </programlisting>
    </section>


        <section xml:id="list-flavors">
            <title>Lists available flavors</title>
        <para>
                The following lists the available flavors</para>
        <programlisting language="python">

from credentials import get_nova_credentials_v2
from novaclient.client import Client

credentials = get_nova_credentials_v2()
nova_client = Client(**credentials)

print  nova_client.flavors.list()

        </programlisting>
    </section>

        <section xml:id="details-available-flavors">
            <title>Details of available flavors</title>
        <para>
                The following lists the details of all available flavors</para>
        <programlisting language="python">

from credentials import get_nova_credentials_v2
from novaclient.client import Client

credentials = get_nova_credentials_v2()
nova_client = Client(**credentials)

flavors_list = nova_client.flavors.list()

for flav in flavors_list:
    print "flavor name:", flav.name
    print "flavor RAM:", flav.ram
    print "flavor vcpus:", flav.vcpus
    print "flavor disk:", flav.disk
    print "flavor id:", flav.id
    print "flavor ephemeral:", flav.ephemeral
    print "flavor factor:", flav.rxtx_factor
    print "\n"

        </programlisting>
    </section>
</chapter>
